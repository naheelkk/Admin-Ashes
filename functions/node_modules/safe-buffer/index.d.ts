!1),(r=this._dsbViewModel)===null||r===void 0?void 0:r.setVisibility(!1))}setDsbVisibility(){var t,i,r,u,f;((t=this._msb_dsbViewModel)===null||t===void 0?void 0:t.isEnabled())?(this._msb_dsbViewModel.setVisibility(!0),(i=this._dsbViewModel)===null||i===void 0?void 0:i.setVisibility(!!(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.isInBlendedMode())&&!n.shouldDisplayMsbDsbInWorkScope((r=this.currentQuery)===null||r===void 0?void 0:r.isWorkScopeZI),this.appShown)):((u=this._dsbViewModel)===null||u===void 0?void 0:u.setVisibility(!0,this.appShown),(f=this._msb_dsbViewModel)===null||f===void 0?void 0:f.setVisibility(!1))}pendRefresh(t,i){var r,f;const e=n.AccessTokenManager.getWindowsAccountType();if(this.logBackgroundTask(`DsbManager_pendRefresh_Start_${t}_reason_${i}`),e!=0){if(e!=1||n.isDsbEnabledForEnterprise())if(n.config.msbDsbMoveIntervalTime)this.refreshViewModels(t,i);else if(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isMsbDsbBlendFeatureEnabled()){const f=this.selectDsbViewModels(!1,i);this.shouldUpdateConsumerDsbInBlendedMode()||i!==1?(f===null||f===void 0?void 0:f.forEach(n=>n.refresh(t,i)),(t==3||t==7)&&n.LightweightStorage.setItem(u,n.getCurrentTime().toString())):(r=f[0])===null||r===void 0?void 0:r.refresh(t,i)}else(f=this.selectDsbViewModel(!1,i))===null||f===void 0?void 0:f.refresh(t,i)}else this.mergePendingRefresh(t,i);this.logBackgroundTask(`DsbManager_pendRefresh_End_${t}_reason_${i}`)}mergePendingRefresh(n,t){if(this.logBackgroundTask("DsbManager_mergePendingRefresh_Start"),this.pendingRefreshParameters){const{strategy:i,reason:r}=this.pendingRefreshParameters;i&1&&(n|=1,t==2&&(t=r));(i&6)==2&&(n=n&-7|2)}this.pendingRefreshParameters={strategy:n,reason:t};this.logBackgroundTask("DsbManager_mergePendingRefresh_End")}flushPendingRefresh(){var t,i;const r=n.AccessTokenManager.getWindowsAccountType();if(r!=0&&this.pendingRefreshParameters){const{strategy:u,reason:r}=this.pendingRefreshParameters;this.pendingRefreshParameters=null;n.config.msbDsbMoveIntervalTime?this.refreshViewModels(u,r):(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isMsbDsbBlendFeatureEnabled())?(t=this.selectDsbViewModels(!1,r))===null||t===void 0?void 0:t.forEach(n=>n.refresh(u,r)):(i=this.selectDsbViewModel(!1,r))===null||i===void 0?void 0:i.refresh(u,r)}}selectDsbViewModels(t,i){var u,f;let r=[];const e=n.AccessTokenManager.getWindowsAccountType();return e==1||n.config.msbMockToken?((u=this._msb_dsbViewModel)===null||u===void 0?void 0:u.isEnabled())||n.config.msbMockToken?(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.isInBlendedMode())&&!n.shouldDisplayMsbDsbInWorkScope((f=this.currentQuery)===null||f===void 0?void 0:f.isWorkScopeZI)?(r.push(this._msb_dsbViewModel),r.push(this._dsbViewModel)):r.push(this._msb_dsbViewModel):n.isConsumerDsbEnabledForEnterprise()&&(n.config.msbDsbBootstrapForceEnable&&i===0&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.shouldForceEnterprise())?r.push(this._msb_dsbViewModel):r.push(this._dsbViewModel)):e!=0&&r.push(this._dsbViewModel),this.handleViewModelsChange(r,t),r}handleViewModelsChange(n,t){const i=this.getViewModelMode(n),r=this.getViewModelMode(this.previouslySelectedViewModels);if(i!=r){this.previouslySelectedViewModels=n;this.onViewModelChanged(n[0])}t&&this.setDsbVisibility()}getViewModelMode(n){if(n.length==2)return"Blended";if(n.length==1){if(n[0]==this._msb_dsbViewModel)return"Enterprise";if(n[0]==this._dsbViewModel)return"Consumer"}return"None"}selectDsbViewModel(t,i){var u;let r;const f=n.AccessTokenManager.getWindowsAccountType();return f==1||n.config.msbMockToken?((u=this._msb_dsbViewModel)===null||u===void 0?void 0:u.isEnabled())||n.config.msbMockToken?r=this._msb_dsbViewModel:n.isConsumerDsbEnabledForEnterprise()&&(r=n.config.msbDsbBootstrapForceEnable&&i===0&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.shouldForceEnterprise())?this._msb_dsbViewModel:this._dsbViewModel):f!=0&&(r=this._dsbViewModel),this.handleViewModelChange(r,t),r}handleViewModelChange(n,t){if(this.previouslySelectedViewModel!==n){this.previouslySelectedViewModel=n;this.onViewModelChanged(n)}t&&this.setDsbVisibility()}onViewModelChanged(t){if(this.setDsbVisibility(),t===null||t===void 0?void 0:t.shouldUpdateGleamAndTimeInterval()){this.updateDynamicSearchBoxContent(`DynamicSearchManager.onViewModelChanged`,t===null||t===void 0?void 0:t.getName());let i=t===null||t===void 0?void 0:t.getUpdateIntervalMins();this.shouldOverwriteInterval(t)&&(i=(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.getRemainingTimeToWorkStartHour())+1);this.setViewModelUpdateInterval(i)}}onBackgroundTask(){if(n.Host.isTSInSearchBoxAvailable()&&this.refreshPlaceHolderText()){const n=this._dsbViewModel.getUpdateIntervalMins();this.setViewModelUpdateInterval(n);this.pendRefresh(0,1)}else this.pendRefresh(this.appShown?7:3,1)}setViewModelUpdateInterval(n){let t;n!=null&&(t=this.setDynamicSearchBoxUpdateInterval(n))}refreshViewModels(t,i){if(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isMsbDsbBlendFeatureEnabled()){const r=this.selectDsbViewModels(!1,i);if(i===1&&this.shouldOverwriteInterval(r[0])){const t=(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.getRemainingTimeToWorkStartHour())+1;this.setViewModelUpdateInterval(t)}r.forEach(n=>n.refresh(t,i))}else{const r=this.selectDsbViewModel(!1,i);if(i===1&&this.shouldOverwriteInterval(r)){const t=(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.getRemainingTimeToWorkStartHour())+1;this.setViewModelUpdateInterval(t)}r===null||r===void 0?void 0:r.refresh(t,i)}}shouldOverwriteInterval(t){if(t===this._dsbViewModel&&(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.isOffWorkHour())){const t=n.getCurrentDate(),i=new Date(t);return i.setHours(t.getHours()+n.DEFAULT_DSB_UPDATE_INTERVAL_HOURS),n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.isInNextWorkTimePeriod(i)}return!1}refreshPlaceHolderText(){let i=!1;const t=this.selectDsbViewModel();if(t===this._dsbViewModel){const r=t===null||t===void 0?void 0:t.getUpdateIntervalMins(!0),u=t===null||t===void 0?void 0:t.getUpdateIntervalMins();if(r&&u){const t=n.getPlaceholdertextRotateCount(),f=r/u;i=t<f;i||n.setPlaceholdertextRotateCount(0)}}return i}async setViewModelDynamicSearchBoxContent(t,i){var v,u,y,f,o,s,p,h,w,c,b,l,k,a;if(n.config.msbDsbEmptyGleamInvestigation&&(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.logGleamSetup("FunctionEntry",t,i)),n.isBingGleamDisabledByRegionalPolicy()){n.config.msbDsbEmptyGleamInvestigation&&(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.logGleamSetup("ClearedByRegionalPolicy",t,i+" GleamDisabledByRegionalPolicy"));await((u=(v=SearchAppWrapper.CortanaApp).clearDynamicContent)===null||u===void 0?void 0:u.call(v));await((f=(y=SearchAppWrapper.CortanaApp).removeDynamicSearchBoxContent)===null||f===void 0?void 0:f.call(y));this.previousDynamicSearchBoxContent=undefined;return}await r.lock();this.logBackgroundTask("DsbManager_setViewModelDynamicSearchBoxContent_Start");try{if(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.disableDSBSearchBoxContent)return;if(n.isSearchPointsOfFlexibilityEnabled()&&(n.AccessTokenManager.getWindowsAccountType()!=1||n.isConsumerDsbEnabledForEnterprise())){const r=(o=t===null||t===void 0?void 0:t.getSearchAppearanceGleamContent)===null||o===void 0?void 0:o.call(t);if(this.previousDynamicSearchBoxContent=undefined,r){let n=r.contentType;n==1?await this.setSearchAppearanceContent(r):n==2&&await this.setSearchAppearanceContentFor3p(r,(s=this.currentQuery)===null||s===void 0?void 0:s.thirdPartySearch)}else this.logBackgroundTask("DsbManager_no_vm_selected"),n.config.msbDsbEmptyGleamInvestigation&&(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.logGleamSetup("ClearedByNullContent",t,i+" NoVmSelected")),await((h=(p=SearchAppWrapper.CortanaApp).clearDynamicContent)===null||h===void 0?void 0:h.call(p)),await((c=(w=SearchAppWrapper.CortanaApp).removeDynamicSearchBoxContent)===null||c===void 0?void 0:c.call(w)),this.previousDynamicSearchBoxConteleaving memory not initialized, so the contents
     * of the newly created Buffer are unknown and may contain sensitive data.
     *
     * @param size count of octets to allocate
     */
    static allocUnsafe(size: number): Buffer;
    /**
     * Allocates a new non-pooled buffer of {size} octets, leaving memory not initialized, so the contents
     * of the newly created Buffer are unknown and may contain sensitive data.
     *
     * @param size count of octets to allocate
     */
    static allocUnsafeSlow(size: number): Buffer;
  }
}