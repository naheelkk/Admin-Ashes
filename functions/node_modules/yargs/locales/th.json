tHeaders:b}=i;let s,h,c,r,u,f,e;try{if(s=performance.now(),h=n.getCurrentDate(),c=n.getCurrentTime(),(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbHttpFail)==="at-call")throw new Error("mocked failed error at call");e=await SearchAppWrapper.CortanaApp.makeHttpRequestAsync(v,y,p,w,b);r=performance.now();u=n.getCurrentDate();f=n.getCurrentTime()}catch(a){return r=performance.now(),u=n.getCurrentDate(),f=n.getCurrentTime(),Promise.reject(new t({statusCode:n.ClientErrorCode.MsbAjaxMakeHttpRequestAsyncError,perfStart:s,perfEnd:r,startDateTime:h,endDateTime:u,requestSentTime:c,responseReceivedTime:f},{publicMessage:`[MsbHttpWrapper].callMakeHttpRequestApiAsync failed when calling API`},a))}const l=this.createResponseContext(e.contentHeaders,e.statusCode,c,f,s,r,h,u);let o;try{if((n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbHttpFail)==="at-read")throw new Error("mocked failed error at read");o=await e.readAsStringAsync();l.responseText=o}catch(a){return Promise.reject(new t(l,{publicMessage:`[MsbHttpWrapper].callMakeHttpRequestApiAsync failed when reading response`,privateMessage:o},a))}return{responseContext:l,responseText:o}}async fetchWrapperAsync(n){const r=this.buildFetchParameters(n),t=await this.callFetchApiAsync(r),{responseContext:i}=t;this.checkServerTime(n,i,"fetchWrapperAsync");const u=n.skipParseResultJson?t.responseText:await this.parseApiCallResultAsync(t,"fetchWrapperAsync");return{responseContext:i,result:u}}buildFetchParameters(i){try{const{method:r,url:f,token:e,skipToken:o,noCredentials:s,body:h,headers:u,ignoreDefaultHeaders:c}=i,t=new Headers;if(!c){o||t.append("Authorization",`Bearer ${e}`);t.append("Content-Type","application/json");const i=n.Host.getLanguage();t.append("X-Search-TrafficType","WsbClient");t.append("X-MSEdge-UILang",i);t.append("X-FD-UILang",i);t.append("X-Client-Language",i);t.append("User-Agent",n.getUserAgent())}for(const n in u)t.append(n,u[n]);const l=r=="GET"?undefined:h||"";return{url:f,method:r,body:l,headers:t,noCredentials:s}}catch(r){throw new t({statusCode:n.ClientErrorCode.MsbHttpBuildApiParameterError},{publicMessage:`[MsbHttpWrapper].buildFetchParameters failed`},r);}}async callFetchApiAsync(i){const{url:v,method:y,body:p,headers:w,noCredentials:b}=i;let s,h,c,r,u,f,e;try{if(s=performance.now(),h=n.getCurrentDate(),c=n.getCurrentTime(),(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbHttpFail)==="at-call")throw new Error("mocked failed error at call");const t=b?undefined:"include";e=await fetch(v,{method:y,body:p,headers:w,credentials:t});r=performance.now();u=n.getCurrentDate();f=n.getCurrentTime()}catch(a){return r=performance.now(),u=n.getCurrentDate(),f=n.getCurrentTime(),Promise.reject(new t({statusCode:n.ClientErrorCode.FetchError,perfStart:s,perfEnd:r,startDateTime:h,endDateTime:u,requestSentTime:c,responseReceivedTime:f},{publicMessage:`[MsbHttpWrapper].callFetchApiAsync failed when calling API`},a))}const l=this.createResponseContext(e.headers,e.status,c,f,s,r,h,u);let o;try{if((n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbHttpFail)==="at-read")throw ne