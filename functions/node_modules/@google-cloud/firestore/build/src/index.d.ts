/*!
 * Copyright 2017 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/// <reference types="node" />
import * as firestore from '@google-cloud/firestore';
import { Duplex } from 'stream';
import { google } from '../protos/firestore_v1_proto_api';
import { BulkWriter } from './bulk-writer';
import { BundleBuilder } from './bundle';
import { DocumentSnapshot, QueryDocumentSnapshot } from './document';
import { CollectionReference, DocumentReference } from './reference';
import { Serializer } from './serializer';
import { Transaction } from './transaction';
import { FirestoreStreamingMethod, FirestoreUnaryMethod } from './types';
import { WriteBatch } from './write-batch';
import api = google.firestore.v1;
import { CollectionGroup } from './collection-group';
export { CollectionReference, DocumentReference, QuerySnapshot, Query, } from './reference';
export { BulkWriter } from './bulk-writer';
export { DocumentSnapshot, QueryDocumentSnapshot } from './document';
export { FieldValue } from './field-value';
export { Filter } from './filter';
export { WriteBatch, WriteResult } from './write-batch';
export { Transaction } from './transaction';
export { Timestamp } from './timestamp';
export { DocumentChange } from './document-change';
export { FieldPath } from './path';
export { GeoPoint } from './geo-point';
export { CollectionGroup };
export { QueryPartition } from './query-partition';
export { setLogFunction } from './logger';
/**
 * The maximum number of times to retry idempotent requests.
 * @private
 */
export declare const MAX_REQUEST_RETRIES = 5;
/**
 * The maximum number of times to attempt a transaction before failing.
 * @private
 */
export declare const DEFAULT_MAX_TRANSACTION_ATTEMPTS = 5;
/**
 * Document data (e.g. for use with
 * [set()]{@link DocumentReference#set}) consisting of fields mapped
 * to values.
 *
 * @typedef {Object.<string, *>} DocumentData
 */
/**
 * Converter used by [withConverter()]{@link Query#withConverter} to transform
 * user objects of type T into Firestore data.
 *
 * Using the converter allows you to specify generic type arguments when storing
 * and retrieving objects from Firestore.
 *
 * @example
 * ```
 * class Post {
 *   constructor(readonly title: string, readonly author: string) {}
 *
 *   toString(): string {
 *     return this.title + ', by ' + this.author;
 *   }
 * }
 *
 * const postConverter = {
 *   toFirestore(post: Post): FirebaseFirestore.DocumentData {
 *     return {title: post.title, author: post.author};
 *   },
 *   fromFirestore(
 *     snapshot: FirebaseFirestore.QueryDocumentSnapshot
 *   ): Post {
 *     const data = snapshot.data();
 *     return new Post(data.title, data.author);
 *   }
 * };
 *
 * const postSnap = await Firestore()
 *   .collection('posts')
 *   .withConverter(postConverter)
 *   .doc().get();
 * const post = postSnap.data();
 * if (post !== undefined) {
 *   post.title; // string
 *   post.toString(); // Should be defined
 *   post.someNonExistentProperty; // TS error
 * }
 *
 * ```
 * @property {Function} toFirestore Called by the Firestore SDK to convert a
 * custom model object of type T into a plain Javascript object (suitable for
 * writing directly to the Firestore database).
 * @property {Function} fromFirestore Called by the Firestore SDK to convert
 * Firestore data into an object of type T.
 * @typedef {Object} FirestoreDataConverter
 */
/**
 * Update data (for use with [update]{@link DocumentReference#update})
 * that contains paths mapped to values. Fields that contain dots
 * reference nested fields within the document.
 *
 * You can update a top-level field in your document by using the field name
 * as a key (e.g. `foo`). The provided value completely replaces the contents
 * for this field.
 *
 * You can also update a nested field directly by using its field path as a key
 * (e.g. `foo.bar`). This nested field update replaces the contents at `bar`
 * but does not modify other data under `foo`.
 *
 * @example
 * ```
 * const documentRef = firestore.doc('coll/doc');
 * documentRef.set({a1: {a2: 'val'}, b1: {b2: 'val'}, c1: {c2: 'val'}});
 * documentRef.update({
 *  b1: {b3: 'val'},
 *  'c1.c3': 'val',
 * });
 * // Value is {a1: {a2: 'val'}, b1: {b3: 'val'}, c1: {c2: 'val', c3: 'val'}}
 *
 * ```
 * @typedef {Object.<string, *>} UpdateData
 */
/**
 * An options object that configures conditional behavior of
 * [update()]{@link DocumentReference#update} and
 * [delete()]{@link DocumentReference#delete} calls in
 * [DocumentReference]{@link DocumentReference},
 * [WriteBatch]{@link WriteBatch}, [BulkWriter]{@link BulkWriter}, and
 * [Transaction]{@link Transaction}. Using Preconditions, these calls
 * can be restricted to only apply to documents that match the specified
 * conditions.
 *
 * @example
 * ```
 * const documentRef = firestore.doc('coll/doc');
 *
 * documentRef.get().then(snapshot => {
 *   const updateTime = snapshot.updateTime;
 *
 *   console.log(`Deleting document at update time: ${updateTime.toDate()}`);
 *   return documentRef.delete({ lastUpdateTime: updateTime });
 * });
 *
 * ```
 * @property {Timestamp} lastUpdateTime The update time to enforce. If set,
 *  enforces that the document was last updated at lastUpdateTime. Fails the
 *  operation if the document was last updated at a different time.
 * @property {boolean} exists If set, enforces that the target document must
 * or must not exist.
 * @typedef {Object} Precondition
 */
/**
 * An options object that configures the behavior of
 * [set()]{@link DocumentReference#set} calls in
 * [DocumentReference]{@link DocumentReference},
 * [WriteBatch]{@link WriteBatch}, and
 * [Transaction]{@link Transaction}. These calls can be
 * configured to perform granular merges instead of overwriting the target
 * documents in their entirety by providing a SetOptions object with
 * { merge : true }.
 *
 * @property {boolean} merge Changes the behavior of a set() call to only
 * replace the values specified in its data argument. Fields omitted from the
 * set() call remain untouched.
 * @property {Array<(string|FieldPath)>} mergeFields Changes the behavior of
 * set() calls to only replace the specified field paths. Any field path that is
 * not specified is ignored and remains untouched.
 * It is an error to pass a SetOptions object to a set() call that is missing a
 * value for any of the fields specified here.
 * @typedef {Object} SetOptions
 */
/**
 * An options object that can be used to configure the behavior of
 * [getAll()]{@link Firestore#getAll} calls. By providing a `fieldMask`, these
 * calls can be configured to only return a subset of fields.
 *
 * @property {Array<(string|FieldPath)>} fieldMask Specifies the set of fields
 * to return and reduces the amount of data transmitted by the backend.
 * Adding a field mask does not filter results. Documents do not need to
 * contain values for all the fields in the mask to be part of the result set.
 * @typedef {Object} ReadOptions
 */
/**
 * An options object to configure throttling on BulkWriter.
 *
 * Whether to disable or configure throttling. By default, throttling is
 * enabled. `throttling` can be set to either a boolean or a config object.
 * Setting it to `true` will use default values. You can override the defaults
 * by setting it to `false` to disable throttling, or by setting the config
 * values to enable throttling with the provided values.
 *
 * @property {boolean|Object} throttling Whether to disable or enable
 * throttling. Throttling is enabled by default, if the field is set to `true`
 * or if any custom throttling options are provided. `{ initialOpsPerSecond:
 * number }` sets the initial maximum number of operations per second allowed by
 * the throttler. If `initialOpsPerSecond` is not set, the default is 500
 * operations per second. `{ maxOpsPerSecond: number }` sets the maximum number
 * of operations per second allowed by the throttler. If `maxOpsPerSecond` is
 * not set, no maximum is enforced.
 * @typedef {Object} BulkWriterOptions
 */
/**
 * An error thrown when a BulkWriter operation fails.
 *
 * The error used by {@link BulkWriter~shouldRetryCallback} set in
 * {@link BulkWriter#onWriteError}.
 *
 * @property {GrpcStatus} code The status code of the error.
 * @property {string} message The error message of the error.
 * @property {DocumentReference} documentRef The document reference the
 * operation was performed on.
 * @property {'create' | 'set' | 'update' | 'delete'} operationType The type
 * of operation performed.
 * @property {number} failedAttempts How many times this operation has been
 * attempted unsuccessfully.
 * @typedef {Error} BulkWriterError
 */
/**
 * Status codes returned by GRPC operations.
 *
 * @see https://github.com/grpc/grpc/blob/master/doc/statuscodes.md
 *
 * @enum {number}
 * @typedef {Object} GrpcStatus
 */
/**
 * The Firestore client represents a Firestore Database and is the entry point
 * for all Firestore operations.
 *
 * @see [Firestore Documentation]{@link https://firebase.google.com/docs/firestore/}
 *
 * @class
 *
 * @example Install the client library with <a href="https://www.npmjs.com/">npm</a>:
 * ```
 * npm install --save @google-cloud/firestore
 *
 * ```
 * @example Import the client library
 * ```
 * var Firestore = require('@google-cloud/firestore');
 *
 * ```
 * @example Create a client that uses <a href="https://cloud.google.com/docs/authentication/production#providing_credentials_to_your_application">Application Default Credentials (ADC)</a>:
 * ```
 * var firestore = new Firestore();
 *
 * ```
 * @example Create a client with <a href="https://cloud.google.com/docs/authentication/production#obtaining_and_providing_service_account_credentials_manually">explicit credentials</a>:
 * ```
 * var firestore = new Firestore({ projectId:
 * 'your-project-id', keyFilename: '/path/to/keyfile.json'
 * });
 *
 * ```
 * @example <caption>include:samples/quickstart.js</caption>
 * region_tag:firestore_quickstart
 * Full quickstart example:
 */
export declare class Firestore implements firestore.Firestore {
    /**
     * A client pool to distribute requests over multiple GAPIC clients in order
     * to work around a connection limit of 100 concurrent requests per client.
     * @private
     * @internal
     */
    private _clientPool;
    /**
     * Preloaded instance of google-gax (full module, with gRPC support).
     */
    private _gax?;
    /**
     * Preloaded instance of google-gax HTTP fallback implementation (no gRPC).
     */
    private _gaxFallback?;
    /**
     * The configuration options for the GAPIC client.
     * @private
     * @internal
     */
    _settings: firestore.Settings;
    /**
     * Settings for the exponential backoff used by the streaming endpoints.
     * @private
     * @internal
     */
    private _backoffSettings;
    /**
     * Whether the initialization settings can still be changed by invoking
     * `settings()`.
     * @private
     * @internal
     */
    private _settingsFrozen;
    /**
     * The serializer to use for the Protobuf transformation.
     * @private
     * @internal
     */
    _serializer: Serializer | null;
    /**
     * The project ID for this client.
     *
     * The project ID is auto-detected during the first request unless a project
     * ID is passed to the constructor (or provided via `.settings()`).
     * @private
     * @internal
     */
    private _projectId;
    /**
     * The database ID provided via `.settings()`.
     *
     * @private
     * @internal
     */
    private _databaseId;
    /**
     * Count of listeners that have been registered on the client.
     *
     * The client can only be terminated when there are no pending writes or
     * registered listeners.
     * @private
     * @internal
     */
    private registeredListenersCount;
    /**
     * A lazy-loaded BulkWriter instance to be used with recursiveDelete() if no
     * BulkWriter instance is provided.
     *
     * @private
     * @internal
     */
    private _bulkWriter;
    /**
     * Lazy-load the Firestore's default BulkWriter.
     *
     * @private
     * @internal
     */
    private getBulkWriter;
    /**
     * Number of pending operations on the client.
     *
     * The client can only be terminated when there are no pending writes or
     * registered listeners.
     * @private
     * @internal
     */
    private bulkWritersCount;
    /**
     * @param {Object=} settings [Configuration object](#/docs).
     * @param {string=} settings.projectId The project ID from the Google
     * Developer's Console, e.g. 'grape-spaceship-123'. We will also check the
     * environment variable GCLOUD_PROJECT for your project ID.  Can be omitted in
     * environments that support
     * {@link https://cloud.google.com/docs/authentication Application Default
     * Credentials}
     * @param {string=} settings.keyFilename Local file containing the Service
     * Account credentials as downloaded from the Google Developers Console. Can
     * be omitted in environments that support
     * {@link https://cloud.google.com/docs/authentication Application Default
     * Credentials}. To configure Firestore with custom credentials, use
     * `settings.credentials` and provide the `client_email` and `private_key` of
     * your service account.
     * @param {{client_email:string=, private_key:string=}=} settings.credentials
     * The `client_email` and `private_key` properties of the service account
     * to use with your Firestore project. Can be omitted in environments that
     * support {@link https://cloud.google.com/docs/authentication Application
     * Default Credentials}. If your credentials are stored in a JSON file, you
     * can specify a `keyFilename` instead.
     * @param {string=} settings.host The host to connect to.
     * @param {boolean=} settings.ssl Whether to use SSL when connecting.
     * @param {number=} settings.maxIdleChannels The maximum number of idle GRPC
     * channels to keep. A smaller number of idle channels reduces memory usage
     * but increases request latency for clients with fluctuating request rates.
     * If set to 0, shuts down all GRPC channels when the client becomes idle.
     * Defaults to 1.
     * @param {boolean=} settings.ignoreUndefinedProperties Whether to skip nested
     * properties that are set to `undefined` during object serialization. If set
     * to `true`, these properties are skipped and not written to Firestore. If
     * set `false` or omitted, the SDK throws an exception when it encounters
     * properties of type `undefined`.
     * @param {boolean=} settings.preferRest Whether to force the use of HTTP/1.1 REST
     * transport until a method that requires gRPC is called. When a method requires gRPC,
     * this Firestore client will load dependent gRPC libraries and then use gRPC transport
     * for communication from that point forward. Currently the only operation
     * that requires gRPC is creating a snapshot listener with the method
     * `DocumentReference<T>.onSnapshot()`, `CollectionReference<T>.onSnapshot()`, or
     * `Query<T>.onSnapshot()`. If specified, this setting value will take precedent over the
     * environment variable `FIRESTORE_PREFER_REST`. If not specified, the
     * SDK will use the value specified in the environment variable `FIRESTORE_PREFER_REST`.
     * Valid values of `FIRESTORE_PREFER_REST` are `true` ('1') or `false` (`0`). Values are
     * not case-sensitive. Any other value for the environment variable will be ignored and
     * a warning will be logged to the console.
     */
    constructor(settings?: firestore.Settings);
    /**
     * Specifies custom settings to be used to configure the `Firestore`
     * instance. Can only be invoked once and before any other Firestore method.
     *
     * Iat-multi-range-holder"></div><div class="waffle-flat-multi-range-add-another">Add another range</div><br/>'+ut({Cd:"waffle-flat-multi-range-select-done",content:O("Ok"),style:2},c);return O(a+'<div class="waffle-flat-multi-range-select-message">Select a range</div></div>')}var t7s={2:[{}]},u7s={6:Ebc};function v7s(a,c,d,e){IB.call(this,65);this.Eg=a;this.qa=Oa(c);this.ua=d;this.oa=e}A(v7s,IB);
v7s.prototype.Vf=function(a){var c=this.Nd();return opm(c,a.qa)};v7s.prototype.Nd=function(){for(var a=E8l(QDm().Cl(this.qa),FBm(this.ua)),c=0;c<this.oa.length;c++){var d=a,e=FBm(this.oa[c]);tm(d,6,e,Uz)}a=RDm().setData(a.build());return mm(a,3,this.Eg).build()};v7s.prototype.Rn=q(!1);function w7s(a){IB.call(this,67);this.Eg=a}A(w7s,IB);w7s.prototype.Vf=function(){var a=this.Nd();return Fpm(a)};w7s.prototype.Nd=function(){var a=Gpm();return mm(a,1,this.Eg).build()};w7s.prototype.Rn=q(!1);function x7s(a,c,d,e,f){IB.call(this,66);this.Eg=a;this.qa=c?Oa(c):void 0;this.ua=d;this.oa=e;this.va=f}A(x7s,IB);x7s.prototype.Vf=function(a){var c=this.Nd(),d=new p7s;a=a.qa;XU(d);L(c,1);c.Qo();d.va=Pl(c,1);d.ea=kpm(c.getData());d.qa=Ml(c.getData(),2);d.ma=lpm(c.getData());d.oa=L(c.getData(),4)?c.getData().kf():null;d.xa=a;d.wa=Ml(c,4);return d};
x7s.prototype.Nd=function(){var a=void 0===a?Ll(W8c):a;a=new X8c(a);var c=QDm();this.qa&&c.Cl(this.qa);E8l(c,FBm(this.ua));if(this.oa)for(var d=0;d<this.oa.length;d++){var e=c,f=FBm(this.oa[d]);tm(e,6,f,Uz)}else km(a,4,!0);D8l(c,this.va);a.setData(c.build());mm(a,1,this.Eg);return a.build()};x7s.prototype.Rn=q(!1);function y7s(a,c,d,e,f,g){uy.call(this,g);this.va=a;this.ua=new mz(void 0,sz.Nb(),this.Ja());this.bb(this.ua);this.ea=new uy(this.Ja());this.bb(this.ea);this.ma=new jC;this.bb(this.ma);this.za=d||!1;this.Aa=f||!1;this.oa=-1;this.qa=null;this.Ak=c;this.xa=e;this.wa=new YC(this.Ja());this.Fa(this.wa)}A(y7s,uy);v=y7s.prototype;v.Ya=function(){var a=Ip(s7s);this.tc(a)};
v.eb=function(){uy.prototype.eb.call(this);this.ea.Vb(this.Ma("waffle-flat-multi-range-holder"));this.ua.Vb(this.Ma("waffle-flat-multi-range-add-another"));this.ma.Vb(this.Ma("waffle-flat-multi-range-select-done"));this.getHandler().listen(this.ua,"action",Bl(this.xRa)).listen(this.ma,"action",this.pWd);this.ma.setVisible(!1);this.xRa(!0)};
function z7s(a,c){for(var d=a.ea.Nf(!0),e=0;e<d.length;e++)d[e].dispose();a.xRa(!0);if(0<c.length)for(A7s(a,0).setValue(c[0]),d=1;d<c.length;d++)a.xRa(!0).setValue(c[d])}v.Cf=function(){for(var a=[],c=0;c<B7s(this);c++){var d=A7s(this,c).getValue();Na(d)||a.push(d)}return a};v.setVisible=function(a){ro(this.gb(),a)};v.pWd=function(){C7s(this,!1)};
function C7s(a,c){c?a.getHandler().listen(a.va,"selectionChange",a.Xhc):(a.getHandler().Pe(a.va,"selectionChange",a.Xhc),A7s(a,B7s(a)-1).gb().focus());Ux(a.gb(),"waffle-flat-multi-range-select-listening",c);a.ma.setVisible(c);a.Ak(c)}v.Xhc=function(a){var c=a.ho;a=this.Aa?a.gD:null;if(1==c.length)this.oa=-1,c=dA(c[0],a),this.qa&&this.qa.setValue(c);else{-1==this.oa&&(this.oa=B7s(this)-1);for(var d=0;d<c.length;d++){var e=c[d],f=this.oa+d;f=f>=B7s(this)?this.xRa():A7s(this,f);e=dA(e,a);f.setValue(e)}}};
v.xRa=function(a){var c=new D7s(this,this.za,this.xa,this.Ja());this.ea.Ul(c,B7s(this),!0);E7s(this);a||F7s(c);return c};v.yid=function(a){var c=this;this.ea.removeChild(a,!0);a.dispose();E7s(this);ZC(this.wa,"Range removed");Uo(function(){0<B7s(c)&&F7s(A7s(c,B7s(c)-1))},0,this)};function E7s(a){for(var c=B7s(a),d=0;d<c;d++)A7s(a,d).ma.setVisible(1!=c)}function B7s(a){return a.ea.fe()}function A7s(a,c){B7s(a);return a.ea.De(c)}
function D7s(a,c,d,e){uy.call(this,e);var f=this;this.oa=a;this.ea=new x9l(new Po,function(){F7s(f);C7s(f.oa,!0)},c,d,!0,void 0,this.Ja());this.bb(this.ea);this.ma=new jC;this.bb(this.ma)}A(D7s,uy);v=D7s.prototype;v.Ya=function(){var a=Ip(r7s);this.tc(a)};
v.eb=function(){uy.prototype.eb.call(this);this.ea.Vb(this.Ma("waffle-range-selection-holder"));this.ma.Vb(this.Ma("waffle-flat-multi-range-remove"));Kz(this.ma.gb());this.getHandler().listen(this.ma,"action",Ea(this.oa.yid,this.oa,this)).listen(this.ea.hg(),"focus",this.Yhc)};function F7s(a){QR(a.ea.ea);a.Yhc()}
v.Yhc=function(){Qx(this.ea.gb(),"waffle-flat-multi-range-active-editbox");var a=this.oa;a.qa=this;for(var c=0;c<B7s(a);c++){var d=A7s(a,c);d!=this&&(Sx(d.ea.gb(),"waffle-flat-multi-range-active-editbox"),Sx(d.ea.gb(),"active"))}};v.getValue=function(){return this.ea.getValue()};v.setValue=function(a){this.ea.setValue(a)};function G7s(a){this.Ia=Ob(a)}A(G7s,xd);G7s.prototype.getId=function(){return Jc(this,1)};G7s.prototype.xc=function(a){return hd(this,1,a)};function H7s(a){this.Jb=a}A(H7s,Jl);function I7s(){var a=void 0===a?Ll(H7s):a;return new J7s(a)}H7s.prototype.kb=function(){return new J7s(this)};H7s.prototype.getId=function(){return Pl(this,1)};H7s.Mb=G7s;function J7s(a){hm.call(this,a)}A(J7s,hm);J7s.prototype.getId=function(){return this.ea.getId()};J7s.prototype.xc=function(a){return mm(this,1,a)};function K7s(a){this.Ia=Ob(a)}A(K7s,xd);v=K7s.prototype;v.getEmail=function(){return Jc(this,2)};v.Fs=function(){return td(this,2)};v.getId=function(){return Jc(this,3)};v.xc=function(a){return hd(this,3,a)};v.getType=function(){return Kc(this,4,0)};v.yb=function(a){return ld(this,4,a)};function L7s(a){this.Ia=Ob(a)}A(L7s,xd);L7s.prototype.getId=function(){return Jc(this,1)};L7s.prototype.xc=function(a){return hd(this,1,a)};L7s.Tb=[2,4];function M7s(a){this.Jb=a}A(M7s,Jl);v=M7s.prototype;v.kb=function(){return new N7s(this)};v.Fs=function(){return L(this,2)};v.getEmail=function(){return Pl(this,2)};v.getId=function(){return Pl(this,3)};v.getType=function(){return Ul(this,4,0)};function O7s(a){return Ul(a,6,0)}M7s.Mb=K7s;function N7s(a){hm.call(this,a)}A(N7s,hm);v=N7s.prototype;v.Fs=function(){return this.ea.Fs()};v.getEmail=function(){return this.ea.getEmail()};v.getId=function(){return this.ea.getId()};
v.xc=function(a){return mm(this,3,a)};v.getType=function(){return this.ea.getType()};v.yb=function(a){return rm(this,4,a)};function P7s(a){this.Jb=a}A(P7s,Jl);P7s.prototype.kb=function(){return new Q7s(this)};P7s.prototype.getId=function(){return Pl(this,1)};P7s.prototype.lH=function(a){return em(this,2,a,M7s)};P7s.Mb=L7s;function Q7s(a){hm.call(this,a)}A(Q7s,hm);Q7s.prototype.getId=function(){return this.ea.getId()};Q7s.prototype.xc=function(a){return mm(this,1,a)};Q7s.prototype.lH=function(a){return this.ea.lH(a)};function R7s(a){this.Ia=Ob(a)}A(R7s,xd);R7s.prototype.getId=function(){return Jc(this,1)};R7s.prototype.xc=function(a){return hd(this,1,a)};R7s.prototype.Rm=function(){return Kc(this,2,0)};R7s.Tb=[3,4];function S7s(a){this.Jb=a}A(S7s,Jl);function T7s(){var a=void 0===a?Ll(S7s):a;return new U7s(a)}S7s.prototype.kb=function(){return new U7s(this)};S7s.prototype.getId=function(){return Pl(this,1)};S7s.prototype.Rm=function(){return Ul(this,2,0)};S7s.Mb=R7s;function U7s(a){hm.call(this,a)}A(U7s,hm);U7s.prototype.getId=function(){return this.ea.getId()};U7s.prototype.xc=function(a){return mm(this,1,a)};U7s.prototype.Rm=function(){return this.ea.Rm()};function V7s(a,c){return rm(a,2,c)};function W7s(a,c,d){Co.call(this);this.ma={};this.oa=null;this.va=a;this.qa=c;this.ua=d;this.ea=null}A(W7s,Co);W7s.prototype.Dy=function(a,c,d){var e=this,f=I7s().xc(a).build(),g=Ea(c,d);this.ea=bs(cs(js(ms(this.va.mj("/protectedrange/acllookup"),{data:f.Fc()}),"POST"),function(k){e.ea=null;k=Kl(P7s,sx(k.Cg(),t7s));e.ma[a]=Pl(k,5);var l=e.ua.ea[a];l&&l.ea&&(k=rm(k.Wd(),3,5).build());g(k,!0)}),function(){e.ea=null;delete e.ma[a];g(null,!1)}).Cj()};
W7s.prototype.update=function(a,c,d){var e=this,f=5==a.getType(),g=k7s(this.ua,a.getId()),k=null;g&&g.ea!=f&&(k=new x7s(g.getId(),void 0,m7s(g),void 0,f));if(f)k?(JB(k,function(m){var n=T7s().xc(a.getId());if(m){var r=void 0===r?Ll(vEf):r;m=new uEf(r);m=km(m,3,!0);e.oa=m.build();V7s(n,2)}else V7s(n,5);c.call(d,a,n.build(),!0)}),this.qa.ea(k)):(f=V7s(T7s().xc(a.getId()),1).build(),c.call(d,a,f,!0));else{f=this.ma[a.getId()];a.getId();a=X7s(a.Wd(),f).build();var l=Ea(c,d,a);this.ea=bs(cs(js(ms(this.va.mj("/protectedrange/aclupdate"),
{data:a.Fc()}),"POST"),function(m){var n=k;e.ea=null;m=Kl(S7s,sx(m.Cg(),u7s));3==m.Rm()&&(e.ma[m.getId()]=Pl(m,5));L(m,6)&&(e.oa=Xl(m,6,vEf));l(m,!0);if(n)switch(m.Rm()){case 3:case 2:case 1:case 8:e.qa.ea(n)}}),function(){e.ea=null;l(null,!1)}).Cj()}};W7s.prototype.zb=function(){Co.prototype.zb.call(this);Ao(this.ea)};function Y7s(){var a='<div id="waffle-ritz-protection-acl-loading"><div id="waffle-ritz-protection-acl-loading-text" class="waffle-ritz-protection-acl-loading-text"></div><div id="waffle-ritz-protection-acl-loading-spinner" class="waffle-ritz-protection-acl-loading-spinner">'+Mxn()+'</div></div><div id="waffle-ritz-protection-acl-content">';var c='<div class="waffle-ritz-protection-chooser-area" id="waffle-ritz-protection-chooser-area"><div class="waffle-ritz-protection-type-buttons" id="waffle-ritz-protection-type-buttons" role="radiogroup">'+
Fkn(void 0,void 0,void 0,void 0,void 0,"Show a warning when editing this range","edittype","soft");c+=Fkn(void 0,void 0,void 0,void 0,void 0,"Restrict who can edit this range","edittype","hard");c=c+'</div><div id="waffle-ritz-protection-dropdown" class="waffle-ritz-protection-dropdown" aria-label="'+xp("Who can edit this range");c=O(c+'"></div></div>');a+=c;c=O('<div id="waffle-ritz-protection-custom-container" class="waffle-ritz-protection-custom-container">'+O('<div class="waffle-ritz-protection-acl-header"><span class="waffle-ritz-protection-acl-header-name" id="waffle-ritz-protection-acl-header">Choose who can edit</span><span class="waffle-ritz-protection-acl-header-edit"><div id="waffle-ritz-protection-acl-header-edit-checkbox" class="waffle-ritz-protection-acl-header-edit-checkbox"></div></span></div><div class="waffle-ritz-protection-acl-table-container"><table class="waffle-ritz-protection-acl-table" id="waffle-ritz-protection-acl-table" cellspacing="0"><colgroup><col class="waffle-ritz-protection-acl-scope-col"><col class="waffle-ritz-protection-acl-edit-col"></colgroup></table></div>')+
'<div id="waffle-ritz-protection-input-butter"></div>'+O('<div class="waffle-ritz-protection-add-editors-container"><div class="waffle-ritz-protection-add-editors-label">Add editors:</div><div id="waffle-ritz-protection-add-editors-input" class="waffle-ritz-protection-add-editors-search-box"></div></div>')+"</div>");a=a+c+'<div id="waffle-ritz-protection-list" class="waffle-ritz-protection-list" aria-label=\''+xp("Protected ranges list");return O(a+'\' role="listbox"></div></div>')}
function Z7s(a){var c=a.Sqe,d=a.Rqe;return O('<div class="waffle-ritz-protection-acl-butter"><div class="waffle-ritz-protection-acl-butter-text">'+rp(a.text)+"</div>"+(vp(c)?" "+(vp(d)?'<a href="'+Q(Bp(d))+'" target="_blank" class="waffle-ritz-protection-acl-butter-href" title="'+Q(c)+'">'+rp(c)+"</a>":'<div class="waffle-ritz-protection-acl-butter-action" tabindex="0">'+rp(c)+"</div>"):"")+"</div>")}
function $7s(a){var c=a.name,d=a.Uqe,e=a.Vqe;return O('<table><tr class="waffle-ritz-protection-acl-row '+(vp(a.sBd)?"waffle-ritz-protection-acl-missing":"")+'" role="row"><td role="rowheader"><div class="waffle-ritz-protection-acl-scope"><span class="waffle-ritz-protection-acl-icon-container" aria-hidden="true"></span><span class="waffle-ritz-protection-acl-text"><span class="waffle-ritz-protection-acl-name">'+rp(c)+"</span>"+(vp(d)?'  <span class="waffle-ritz-protection-acl-detail">'+rp(d)+"</span>":
"")+(vp(e)?'&nbsp;<span class="waffle-ritz-protection-acl-email">'+rp(e)+"</span>":"")+'</span></div></td><td role="gridcell"><span class="waffle-ritz-protection-acl-checkbox"></span></td></tr></table>')}function a8s(a){var c=a.szd;return O('<img src="'+Q(Cp(a.iconUrl))+'" class="waffle-ritz-protection-acl-custom-icon"><span class="waffle-ritz-protection-acl-default-icon apps-share-sprite '+Q(c)+'"></span>')}
function b8s(a){var c=a.Jm;return O('<div class="waffle-ritz-protection-item"><div class="waffle-ritz-protection-item-name">'+rp(a.name)+"</div>"+(vp(c)?'<div class="waffle-ritz-protection-item-range">'+rp(c)+"</div>":"")+"</div>")};function c8s(a,c){uy.call(this,c);this.ea=a;this.oa=this.ma=null}A(c8s,uy);c8s.prototype.Ef=function(a){uy.prototype.Ef.call(this,a);var c;L(this.ea,1)&&(c=Pl(this.ea,1));switch(this.ea.getType()){case 1:var d="vo-domain-public-icon";break;case 2:d="scope-icon-default-group";break;default:d="scope-icon-default-user"}a.appendChild(Ip(a8s,{iconUrl:c||"",szd:d}))};
c8s.prototype.eb=function(){var a=this;uy.prototype.eb.call(this);this.ma=this.Ma("waffle-ritz-protection-acl-custom-icon");this.oa=this.Ma("waffle-ritz-protection-acl-default-icon");this.ma.onerror=function(){d8s(a,!0)};d8s(this,!1)};c8s.prototype.jg=function(){delete this.ma.onerror};c8s.prototype.wb=function(a){this.getElement()&&Ux(this.getElement(),"waffle.ritzprotection-icon-disabled",!a)};function d8s(a,c){c=!c&&L(a.ea,1);ro(a.ma,c);ro(a.oa,!c)};function e8s(a,c){uy.call(this,c);this.ea=a;this.ma=new c8s(a,c);this.bb(this.ma);this.Vra=new pWk;this.bb(this.Vra)}A(e8s,uy);v=e8s.prototype;v.lH=p("ea");v.BIa=function(){return this.Vra.xf()};v.isEnabled=function(){return this.Vra.isEnabled()};v.Ya=function(){var a;4==this.ea.getType()?a="(you)":4==O7s(this.ea)&&(a="(owner)");var c=3==O7s(this.ea);a=Ip($7s,{name:Pl(this.ea,5),Uqe:a,Vqe:this.ea.getEmail()||void 0,sBd:c});a=Jn(this.Ja(),"tr","waffle-ritz-protection-acl-row",a)[0];this.tc(a)};
v.eb=function(){uy.prototype.eb.call(this);this.ma.Vb(this.Ma("waffle-ritz-protection-acl-icon-container"));this.Vra.Vb(this.Ma("waffle-ritz-protection-acl-checkbox"));var a=!1,c=!1;switch(O7s(this.ea)){case 1:c=a=!1;break;case 2:a=!0;c=!1;break;case 3:a=!0;c=!1;break;case 4:c=a=!0}4!=this.ea.getType()||!a&&i7s()||(c=!0);this.Vra.Ud(a);this.Vra.wb(!c)};function f8s(a,c,d,e){uy.call(this,e);this.ua=a;this.qa=ztq(c);this.qa.yNa("Enter names or email addresses");this.qa.kCc="Add editors";this.qa.WQc=!0;this.qa.jy(2);this.ea=new uy(this.Ja());this.bb(this.ea);this.oa=new pWk;this.bb(this.oa)}A(f8s,uy);v=f8s.prototype;v.reset=function(){var a=this.ea.Nf(!0);Bo(a);this.ma.dispose();this.ma=g8s(this)};function h8s(a,c){c=c.map(function(d){return CB(d)});a.ma.select(c)}v.setVisible=function(a){ro(this.getElement(),a)};
v.eb=function(){uy.prototype.eb.call(this);var a=this.Ja();this.va=In(a,"waffle-ritz-protection-input-butter");this.ea.Vb(In(a,"waffle-ritz-protection-acl-table"));this.ma=g8s(this);this.oa.Vb(In(a,"waffle-ritz-protection-acl-header-edit-checkbox"));Ry(In(a,"waffle-ritz-protection-acl-header-edit-checkbox"),"labelledby","waffle-ritz-protection-acl-header");this.getHandler().listen(this.oa,"change",this.EZd).listen(this.ea,"change",this.Z7d)};
function i8s(a){var c=void 0;a.ea.Mj(function(d){d.isEnabled()&&(void 0===c?c=d.BIa():d.BIa()!=c&&(c=null))},a);void 0===c&&(c=!0);a.oa.Ud(c)}v.Z7d=function(a){a.stopPropagation();i8s(this)};v.EZd=function(a){this.ea.Mj(function(c){if(c.isEnabled()){var d=this.oa.xf();c.Vra.Ud(d)}},this);a.stopPropagation()};
function j8s(a,c){var d=c.Wd();d.yb(4);a.ea.Mj(function(e){if(e.BIa())switch(e=e.lH(),e.getType()){case 1:km(d,4,!0);break;case 5:k8s(d,e.getId());break;case 2:e=e.getId();lm(d,6,e);break;case 3:case 4:e=e.getId(),lm(d,5,e)}},a);a=l8s(a);for(c=0;c<a.length;c++)lm(d,7,a[c]);return d.build()}function g8s(a){var c=In(a.Ja(),"waffle-ritz-protection-add-editors-input");return Atq(c,a.ua,a.qa)}
function l8s(a){return a.ma.Aj.yQ().map(function(c){return c.id().getValue()}).concat(q7s(a.ma.dgb()).map(function(c){return c.address}))}v.zb=function(){this.ma&&this.ma.dispose();uy.prototype.zb.call(this)};function m8s(a){uy.call(this,a);this.ea=new AC("\u2014",void 0,this.Ja());this.bb(this.ea);this.getHandler().listen(this,["aftershow","afterhide"],this.zid)}A(m8s,uy);v=m8s.prototype;v.eb=function(){uy.prototype.eb.call(this);var a=this.Ja();this.ea.Vb(In(a,"waffle-ritz-protection-dropdown"));a=In(a,"waffle-ritz-protection-type-buttons");this.ma=Mkn("edittype",a);this.Fa(this.ma);this.ma.jj(this);this.getHandler().listen(this.ma,"change",this.d6d)};
v.setValue=function(a){"EVERYONE"==a?(this.ea.wb(!1),eZ(this.ma,fZ(this.ma,0))):(this.ea.wb(!0),this.ea.setValue(a),eZ(this.ma,fZ(this.ma,1)))};v.getValue=function(){return"soft"==Okn(this.ma)?"EVERYONE":this.ea.getValue()};v.d6d=function(){this.ea.wb("hard"==Okn(this.ma))};v.zid=function(a){a.stopPropagation()};function n8s(){this.ea=[]}
n8s.prototype.ud=function(a){var c=!0,d=!0,e=!0,f=!1,g=!1,k=!1,l="";this.Lc=a;switch(a){case "SAVING":l="Saving\u2026";e=d=!1;c=!0;k=f=g=!1;break;case "SUCCESS":l="Changes saved!";e=d=!1;c=!0;f=g=!1;k=!0;break;case "LOADING":l="Loading permissions\u2026";c=d=!0;e=!1;g=!0;k=f=!1;break;case "LOADED":l="";c=d=!1;g=e=!0;k=f=!1;break;case "ERROR_LOADING":l="Unable to load permissions. Please try again later.";d=!1;e=c=!0;g=!1;f=!0;k=!1;break;case "ERROR_NO_PERMS":l="You no longer have permission to change the protection settings. Try contacting the owner of this spreadsheet if you think this is a mistake.",d=
!1,e=c=!0,g=!1,f=!0,k=!1}this.Ca=f;this.ma=d;this.qa=l;this.ua=e;this.Ba=g;this.xa=c;this.va=!c;this.oa=k};n8s.prototype.getState=p("Lc");function o8s(a,c,d,e,f,g,k){this.qa=a;this.oa=c;this.ua=d;this.va=e;this.id=f;this.ea=g;this.ma=k};function p8s(a,c,d,e){tz.call(this,void 0,void 0,e);this.ma=a;this.ea=c;this.qa=d}A(p8s,tz);p8s.prototype.refresh=function(a){this.Nf(!0);for(var c=Fqd(this.ma),d=0;d<c.length;d++){var e=c[d];if(e.isValid()&&e.canEdit()&&!e.ea&&e.getId()!=a){var f=e.kf(),g=m7s(e),k=e.getId();e=e.rG()?(e=NB(this.qa,e.Na()))?e.Zf():"#REF":b$l(this.ea,g)?c$l(this.ea,g):"#REF";Na(f)&&(f=e,e=null);this.bb(new q8s(f,e,k,this.Ja()),!0)}}};
function q8s(a,c,d,e){hz.call(this,void 0,new r8s,e);this.ea=a;this.Sj=c;this.ma=d}A(q8s,hz);q8s.prototype.getName=p("ea");q8s.prototype.getRange=p("Sj");function r8s(){}A(r8s,dz);r8s.prototype.xe=q("waffle-ritz-protection-item");r8s.prototype.Ya=function(a){return Ip(b8s,{name:a.getName(),Jm:a.getRange()})};function s8s(a){this.Ia=Ob(a)}A(s8s,xd);s8s.prototype.getId=function(){return Jc(this,1)};s8s.prototype.xc=function(a){return hd(this,1,a)};s8s.prototype.getType=function(){return Kc(this,3,0)};s8s.prototype.yb=function(a){return ld(this,3,a)};s8s.Tb=[5,6,7,8];function t8s(a){this.Jb=a}A(t8s,Jl);t8s.prototype.kb=function(){return new u8s(this)};t8s.prototype.getId=function(){return Pl(this,1)};t8s.prototype.getType=function(){return Ul(this,3,0)};t8s.Mb=s8s;function u8s(a){hm.call(this,a)}A(u8s,hm);u8s.prototype.getId=function(){return this.ea.getId()};u8s.prototype.xc=function(a){return mm(this,1,a)};function X7s(a,c){return mm(a,2,c)}u8s.prototype.getType=function(){return this.ea.getType()};u8s.prototype.yb=function(a){return rm(this,3,a)};
function k8s(a,c){lm(a,8,c)};function v8s(a,c,d,e,f,g,k,l,m,n,r){oC.call(this,void 0,void 0,r);this.Ga="Range editing permissions";this.setTitle(this.Ga);this.Aa=a;this.ea=new n8s;this.qb=n;this.za=g;this.Fa(this.za);this.Ea=f;this.qa=new f8s(k,l,m,this.Ja());this.bb(this.qa);this.va=new m8s(this.Ja());this.bb(this.va);this.Ca=this.Ua=this.Qa=this.Ka=this.Ba=null;this.Za=!1;this.ua=this.oa=null;this.wa=new p8s(c,d,e,this.Ja());this.bb(this.wa);this.jb=c}A(v8s,oC);v=v8s.prototype;v.Ya=function(){oC.prototype.Ya.call(this);this.od().appendChild(Ip(Y7s))};
v.eb=function(){oC.prototype.eb.call(this);var a=this.Ja();this.Ka=In(a,"waffle-ritz-protection-acl-content");this.Ba=In(a,"waffle-ritz-protection-acl-loading");this.Qa=In(a,"waffle-ritz-protection-acl-loading-spinner");this.Ua=In(a,"waffle-ritz-protection-acl-loading-text");this.Ca=this.Ja().Ya("DIV",{id:"waffle-ritz-protection-title-butter"});this.Ja().oL(this.Ca,ymi(this));this.qa.Vb(In(a,"waffle-ritz-protection-custom-container"));this.wa.Vb(In(a,"waffle-ritz-protection-list"));this.va.Vb(In(a,
"waffle-ritz-protection-chooser-area"));this.getHandler().listen(this.va,"change",this.TWd).listen(this,"dialogselect",this.Bid).listen(this.wa,"action",this.xUd);w8s(this)};v.xx=function(){var a=this.za.oa,c=this.qb;oC.prototype.xx.call(this);c&&c(null!=a,a)};function w8s(a,c){x8s(a,"LOADING");a.za.Dy(c||a.Aa,a.Aid,a)}
v.Aid=function(a,c){this.qa.reset();if(c){c=this.ea;var d=ux(vx($l(a,2,M7s,!1)));c.ea=[];for(var e,f,g,k={},l=0;l<d.length;l++){var m=d[l],n=O7s(m);k[n]||(k[n]=[]);k[n].push(m);1==m.getType()&&(e=m);5==m.getType()&&(f=m);4==m.getType()&&(g=m)}e&&c.ea.push(e);f&&c.ea.push(f);g&&c.ea.push(g);d=[4,2,1,3];for(l=0;l<d.length;l++)if(m=d[l],k[m])for(n=0;n<k[m].length;n++){var r=k[m][n];r!=e&&r!=g&&r!=f&&c.ea.push(r)}e=this.qa;f=this.ea.ea;g=e.ea.Nf(!0);Bo(g);g=!1;for(c=0;c<f.length;c++)k=new e8s(f[c]),e.ea.bb(k,
!0),k.isEnabled()&&(g=!0);e.oa.wb(g);i8s(e);if(a.getId()!=this.Aa)this.va.setValue("CUSTOM");else{f=Ul(a,3,0);this.oa&&5!=f&&(f=4);e=this.va;a=ux(vx(Vl(a,4,!1)));g=this.ea;c="";for(k=0;k<g.ea.length;k++)if(d=g.ea[k],1==d.getType()||5==d.getType()){c=Pl(d,5);break}g=c;for(c=Dz(e.ea)-1;0<=c;c--)e.ea.RB(c);c=e.Ja();g="People at "+g;bb(a,1)?e.ea.Th(new ZWd("Only you","YOU",c)):bb(a,2)&&e.ea.Th(new ZWd("Only you and spreadsheet owner","YOU_AND_OWNER",c));bb(a,3)&&e.ea.Th(new ZWd(g,"DOMAIN",c));a.includes(6)&&
e.ea.Th(new ZWd(g,"BROADCAST_AUDIENCE",c));e.ea.Th(new ZWd("Custom","CUSTOM",c));e.ea.Th(new xz(c));e.ea.Th(new ZWd("Copy permissions from another range","COPY",c));switch(f){case 5:e.setValue("EVERYONE");e.ea.setValue("CUSTOM");break;case 1:e.setValue("YOU");break;case 2:e.setValue("YOU_AND_OWNER");break;case 3:e.setValue("DOMAIN");break;case 6:e.setValue("BROADCAST_AUDIENCE");break;case 4:e.setValue("CUSTOM")}}x8s(this,"LOADED");this.Kf()}else x8s(this,"ERROR_LOADING")};
v.xUd=function(){w8s(this,uz(this.wa).ma)};v.TWd=function(){var a=this.ea,c=!1,d=!1;switch(this.va.getValue()){case "EVERYONE":case "YOU":case "YOU_AND_OWNER":case "DOMAIN":case "BROADCAST_AUDIENCE":d=c=!1;break;case "CUSTOM"