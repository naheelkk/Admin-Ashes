 t,i;if(!n.shouldShowDSBLayout(this.currentQuery))return[];let r=[];return(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isMsbDsbBlendFeatureEnabled())?this.selectDsbViewModels().forEach(n=>{var t;r.push(...(t=n.getSelectableItems())!==null&&t!==void 0?t:[])}):r.push(...((i=(t=this.selectDsbViewModel())===null||t===void 0?void 0:t.getSelectableItems())!==null&&i!==void 0?i:[])),r}async updateDynamicSearchBoxContent(t,i){var f,e;let r="DSBNotPossible",u;n.isDynamicSearchContentPossible()&&((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isMsbDsbBlendFeatureEnabled())?(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.isInBlendedMode())?(u=this._dsbViewModel,r="BlendedMode"):(u=n.config.msbDsbBootstrapForceEnable&&i&&((f=this.previouslySelectedViewModels[0])===null||f===void 0?void 0:f.getName())===i?this.previouslySelectedViewModels[0]:this.selectDsbViewModels()[0],r="NonBlendedMode"):(u=n.config.msbDsbBootstrapForceEnable&&i&&((e=this.previouslySelectedViewModel)===null||e===void 0?void 0:e.getName())===i?this.previouslySelectedViewModel:this.selectDsbViewModel(),r="DsbNormal"));await this.setViewModelDynamicSearchBoxContent(u,t+" updateDynamicSearchBoxContent."+r)}async update3pDynamicSearchBoxContent(n){let t=this._dsbViewModel;await this.setViewModelDynamicSearchBoxContent(t,n+" updateDynamicSearchBoxContent.DSBNotPossible")}isDSBVisible(){var n,t,i;return((n=this._msb_dsbViewModel)===null||n===void 0?void 0:n.isEnabled())?(t=this._msb_dsbViewModel)===null||t===void 0?void 0:t.getVisibility():(i=this._dsbViewModel)===null||i===void 0?void 0:i.getVisibility()}async trySetDynamicSearchBoxContentWithRetry(t,i,r,u,e,s,h){let v=0,a=!1,c;const l=[];do c=await n.Async.safePromise("setDynamicSearchBoxContentWithResultAsync_url",()=>SearchAppWrapper.CortanaApp.setDynamicSearchBoxContentWithResultAsync(t,i,r,u,e,s,h,!1)),l.push(c),a=!o.includes(c);while(a&&++v<f);c==262144?n.logToMC("Bing_QF_DynamicSearchManager","SkipSettingDynamicContent","logDynamicSearchManager"):c==0?l.length>1&&n.DSBLogWarning("DynamicSearchManager",JSON.stringify({lightGleamValue:i,darkGleamValue:r,results:l,isUrl:s}),new Error("Succeeded to set gleam after failure")):n.DSBLogError("DynamicSearchManager",JSON.stringify({lightGleamValue:i,darkGleamValue:r,results:l,isUrl:s}),new Error("Failed to set gleam"))}async setDynamicSearchBoxContentByJson(t,i,r,u,f,e,o,s,h,c,l,a){var p;let v=h.toISOString();v=v.slice(0,-5)+v.slice(-1);let b={gleamAltText:i!==null&&i!==void 0?i:"",lightGleamUrl:r?u:undefined,darkGleamUrl:r?f:undefined,lightGleamData:r?undefined:u,darkGleamData:r?undefined:f,gleamDimensionEnum:(p=e===null||e===void 0?void 0:e.toString())!==null&&p!==void 0?p:"30x36".toString(),placeholderText:t,expirationTime:v!==null&&v!==void 0?v:"",targetSurface:o?Number(o):undefined,telemetryId:s,showTimeoutInMilliseconds:c,gleamClickEndpoint:l,gleamTooltip:a},w=JSON.stringify(b),y;try{if(y=await n.Async.safePromise("setDynamicContentAsync",()=>SearchAppWrapper.CortanaApp.setDynamicContentAsync(w)),y==262144)n.logToMC("Bing_QF_DynamicSearchManager","SkipSettingDynamicContent","logDynamicSearchManager");else if(y!=0)throw new Error(y.toString());}catch(k){n.DSBLogError("SetDynamicSearchBoxContentResult",`failed to set gleamdata ${k}
 GleamJson:${w}`)}return y}async setDynamicSearchBoxContentUrl(i){let{placeholderText:o,win11ShowForMillis:r,targetSurface:u}=i,{lightGleamDataOrUrl:f,darkGleamDataOrUrl:s,expirationTime:l,gleamSize:h,gleamDimension:a,telemetryId:e,gleamAltText:v,gleamClickEndpoint:y,gleamTooltip:p}=i;r=r!==null&&r!==void 0?r:t;u=u!==null&&u!==void 0?u:0;e||(e=n.getTelemetryIdFromUrl(f));a||(a=n.getGleamDimensionFromGleamSize(h));let c=typeof l=="number"?new Date(l):l;if(n.isDSBSearchApiEnabled())this.setDynamicSearchBoxContentByJson(o,v,!0,f,s,a,u,e,c,r,y,p);else if(n.config.responsiveDynamicSearchAPI)await this.trySetDynamicSearchBoxContentWithRetry(o,f,s,c,h,!0,e);else{if(n.config.targetedDynamicSearchAPI)return n.Async.safePromise("setDynamicContentURLTargeted",()=>SearchAppWrapper.CortanaApp.setDynamicContentURLTargeted(o,f,s,c,h,e,r,u));if(n.config.extendedDynamicSearchAPI)return n.Async.safePromise("setDynamicContentUrl",()=>SearchAppWrapper.CortanaApp.setDynamicContentURL(o,f,s,c,h,e,r));if(SearchAppWrapper.CortanaApp.setDynamicSearchBoxContentURL)return n.Async.safePromise("setDynamicSearchBoxContentUrl",()=>SearchAppWrapper.CortanaApp.setDynamicSearchBoxContentURL(o,f,s,c,h==1));n.log("CortanaApp.setDynamicSearchBoxContent not supported")}}async setDynamicSearchBoxContentRawData(i){let{placeholderText:e,win11ShowForMillis:u,targetSurface:f}=i,{lightGleamDataOrUrl:o,darkGleamDataOrUrl:s,expirationTime:a,gleamSize:h,gleamDimension:c,telemetryId:r,gleamAltText:v,gleamClickEndpoint:y,gleamTooltip:p}=i;u=u!==null&&u!==void 0?u:t;f=f!==null&&f!==void 0?f:0;r=r!==null&&r!==void 0?r:"Not Implemented";c=c!==null&&c!==void 0?c:n.getGleamDimensionFromGleamSize(h);let l=typeof a=="number"?new Date(a):a;if(n.isDSBSearchApiEnabled())this.setDynamicSearchBoxContentByJson(e,v,!1,o,s,c,f,r,l,u,y,p);else if(n.config.responsiveDynamicSearchAPI)await this.trySetDynamicSearchBoxContentWithRetry(e,o,s,l,h,!1,r);else{if(n.config.targetedDynamicSearchAPI)return n.Async.safePromise("setDynamicContentRawDataTargeted",()=>SearchAppWrapper.CortanaApp.setDynamicContentRawDataTargeted(e,o,s,l,h,r,u,f));if(n.config.extendedDynamicSearchAPI)return n.Async.safePromise("setDynamicContentRawData",()=>SearchAppWrapper.CortanaApp.setDynamicContentRawData(e,o,s,l,h,r,u));if(SearchAppWrapper.CortanaApp.setDynamicSearchBoxContentRawData)return n.Async.safePromise("setDynamicSearchBoxContentRawData",()=>SearchAppWrapper.CortanaApp.setDynamicSearchBoxContentRawData(e,o,s,l,h==1));n.log("CortanaApp.setDynamicSearchBoxContentRawData not supported")}}async setSearchAppearanceContent(t){var u,f,e;let i,o=t===null||t===void 0?void 0:t.contentType,r=JSON.stringify(t===null||t===void 0?void 0:t.gleamData);try{if(n.isThirdPartyGleamSupported()){o=2;const s=n.Host.get1pSearchApps(),h=(e=(f=(u=t===null||t===void 0?void 0:t.gleamData)===null||u===void 0?void 0:u.content)===null||f===void 0?void 0:f.taskbarSearchBox)===null||e===void 0?void 0:e.gleam;s&&h||(r="");i=await n.Async.safePromise("setSearchAppearanceForWebProviderAsync",()=>SearchAppWrapper.CortanaApp.setSearchAppearanceForWebProviderAsync(o,r,s))}else i=await n.Async.safePromise("setSearchAppearanceAsync",()=>SearchAppWrapper.CortanaApp.setSearchAppearanceAsync(o,r));if(i.state==262144)n.logToMC("Bing_QF_DynamicSearchManager","SkipSettingSearchAppearanceContent","logDynamicSearchManager");else if(i.state!=0)throw new Error(JSON.stringify(i));}catch(s){n.DSBLogError("SetSearchAppearanceResult",`failed to set gleamdata ${s}
 GleamJson:${r}`)}}async setSearchAppearanceContentFor3p(t,i){let r,f=t===null||t===void 0?void 0:t.contentType,u=(t===null||t===void 0?void 0:t.gleamData)?JSON.stringify(t.gleamData):"";try{let t=i!==null&&i!==void 0?i:n.Host.getThirdPartyMRUSearhApp();if(!t)throw new Error("3p app extenstion is not provided for 3p SearchAppearance");if(r=await n.Async.safePromise("setSearchAppearanceForWebProviderAsync",()=>SearchAppWrapper.CortanaApp.setSearchAppearanceForWebProviderAsync(f,u,t)),r.state==262144)n.logToMC("Bing_QF_DynamicSearchManager","SkipSettingSearchAppearanceForWebProvider","logDynamicSearchManager");else if(r.state!=0)throw new Error(JSON.stringify(r));}catch(e){n.DSBLogError("SetSearchAppearanceResult",`failed to set gleamdata ${e}
 GleamJson:${u}`)}}setDynamicSearchBoxUpdateInterval(t){return SearchAppWrapper.CortanaApp.updateDynamicSearchBoxUpdateInterval?SearchAppWrapper.CortanaApp.updateDynamicSearchBoxUpdateInterval(t):(n.log("CortanaApp.updateDynamicSearchBoxUpdateInterval not supported"),!1)}hasC